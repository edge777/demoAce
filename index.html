<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asia Coin Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
  </head>
<body class="min-h-screen overflow-x-hidden bg-zinc-950 text-white antialiased">
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 h-14 bg-[#0F1B23] border-b border-[#1F2A33]">
        <!-- Desktop Navigation -->
        <div class="hidden lg:flex h-full px-6 items-center justify-between">
            <div class="flex items-center gap-6">
                <a href="#" class="flex items-center gap-2">
                    <img src="assets/images/ChatGPT_Image_Jan_15_2026_07_44_13_PM-1768486466751.png" alt="Circular Blue Logo" class="h-6 w-6 object-cover rounded">
                    <img src="assets/images/ChatGPT_Image_Jan_15_2026_07_35_31_PM-1768486014245.png" alt="ASIA Logo" class="h-6 w-6 object-cover rounded">
                    
                </a>
                
                <div class="flex items-center gap-6">
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Trade</a>
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Portfolio</a>
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Earn</a>
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Vaults</a>
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Staking</a>
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Referrals</a>
                    <a href="#" class="text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Leaderboard</a>
                    <div class="relative">
                        <button id="more-btn" class="flex items-center gap-1 text-[13px] font-medium text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">
                            More
                            <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        
                        <div id="more-dropdown" class="hidden absolute top-full left-0 mt-2 w-48 bg-[#0F1B23] border border-[#1F2A33] rounded-lg shadow-xl z-50">
                            <div class="py-2">
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    <span>Fiat & Spot</span>
                                </a>
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                                    </svg>
                                    <span>Perpetuals</span>
                                </a>
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="9" y1="9" x2="15" y2="15"></line>
                                        <line x1="15" y1="9" x2="9" y2="15"></line>
                                    </svg>
                                    <span>Copy Trading</span>
                                </a>
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                    <span>Trading Bots</span>
                                </a>
                                <div class="border-t border-[#1F2A33] my-2"></div>
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1 11 11L13 22l-4-4 6.39-6.36a2.14 2.14 0 0 0-3-3L6 15"></path>
                                        <path d="m5 8 4 4"></path>
                                        <path d="m12 15 4 4"></path>
                                    </svg>
                                    <span>API</span>
                                </a>
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4M12 8h.01"></path>
                                    </svg>
                                    <span>Help Center</span>
                                </a>
                                <a href="#" class="block px-4 py-2.5 text-[13px] text-[#E6EEF5] hover:bg-[#121F29] transition-colors flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2a8 8 0 1 1 8 8 8 8 0 0 1-8-8z"></path>
                                        <path d="M12 6v6l4 2"></path>
                                    </svg>
                                    <span>Announcements</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <button class="flex w-5 h-5 items-center justify-center text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </button>
                <button class="flex w-5 h-5 items-center justify-center text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6l4 2"></path>
                    </svg>
                </button>
                <button class="h-8 px-4 bg-[#2DD4BF] hover:bg-[#22D3EE] text-[#0B131A] text-[13px] font-semibold rounded-full transition-all">
                    Connect Wallet
                </button>
            </div>
        </div>

        <!-- Mobile Navigation Header (TOP BAR) -->
        <div class="lg:hidden h-full px-4 flex items-center justify-between">
            <!-- LEFT: Hamburger Menu + Logo -->
            <div class="flex items-center gap-2">
                <button id="mobile-menu-btn" class="p-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <img src="assets/images/ChatGPT_Image_Jan_15_2026_07_44_13_PM-1768486466751.png" alt="Circular Blue Logo" class="h-5 w-5 object-cover rounded">
                <img src="assets/images/ChatGPT_Image_Jan_15_2026_07_35_31_PM-1768486014245.png" alt="ASIA Logo" class="h-5 w-5 object-cover rounded">
                
            </div>

            <!-- RIGHT: Connect + Globe + Settings -->
            <div class="flex items-center gap-2">
                <button class="h-7 px-3 bg-[#2DD4BF] hover:bg-[#22D3EE] text-[#0B131A] text-xs font-semibold rounded-full transition-all">
                    Connect
                </button>
                <button class="p-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </button>
                <button class="p-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6l4 2"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Drawer -->
        <div id="mobile-menu" class="hidden lg:hidden border-t border-[#1F2A33] bg-[#0F1B23]">
            <div class="px-4 py-4 space-y-3">
                <a href="#" class="block text-sm text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Trade</a>
                <a href="#" class="block text-sm text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Portfolio</a>
                <a href="#" class="block text-sm text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Earn</a>
                <a href="#" class="block text-sm text-[#9FB0BF] hover:text-[#E6EEF5] transition-colors">Vaults</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
<section class="min-h-screen pt-14 bg-[#0B131A]">
    <!-- DESKTOP LAYOUT -->
    <div class="hidden lg:block h-[calc(100vh-3.5rem)]">
        <div class="h-full flex flex-col">
            
            <!-- MARKET HEADER (72px height) - PERFECTLY ALIGNED -->
            <div class="h-[72px] border-b border-[#1F2A33] bg-[#0F1B23] flex-shrink-0">
                <div class="h-full px-6 flex items-center justify-between">
                    <!-- LEFT SECTION: Pair Info + Market Stats -->
                    <div class="flex items-center gap-6 h-full">
                        <div class="flex items-center gap-2 relative h-full py-4">
                            <button id="market-pair-btn" class="flex items-center gap-2 hover:bg-[#121F29] px-2 py-1 rounded-lg transition-colors">
                                <h1 class="text-[18px] font-semibold leading-6">HYPE / USDC</h1>
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </button>
                            <span class="h-5 px-2 bg-[rgba(31,211,138,0.15)] text-[#1FD38A] text-[11px] font-semibold rounded flex items-center">SPOT</span>
                            
                            <!-- COMPLETELY REBUILT Dropdown Menu with PERFECT Header Alignment -->
                            <div id="market-pair-dropdown" class="hidden absolute top-full left-0 mt-2 w-[760px] bg-[#0F1B23] border border-[#1F2A33] rounded-lg shadow-xl z-50">
                                <!-- Search Bar with Mode Toggle -->
                                <div class="p-4 border-b border-[#1F2A33]">
                                    <div class="flex items-center gap-2">
                                        <div class="flex-1 relative">
                                            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#6B7C8B]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                            </svg>
                                            <input id="market-search-input" type="text" placeholder="Search pairs..." class="w-full bg-[#121F29] border border-[#1F2A33] rounded-lg pl-10 pr-3 py-2 text-[13px] text-[#E6EEF5] outline-none focus:border-[#2DD4BF] transition-colors">
                                        </div>
                                        <div class="flex gap-1 bg-[#121F29] rounded-lg p-1">
                                            <button class="mode-toggle-btn px-3 py-1.5 text-[11px] font-semibold rounded text-[#9FB0BF] hover:bg-[#1F2A33] transition-colors" data-mode="strict">Strict</button>
                                            <button class="mode-toggle-btn px-3 py-1.5 text-[11px] font-semibold rounded bg-[#2DD4BF] text-[#0B131A] transition-colors" data-mode="all">All</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Category Tabs -->
                                <div class="flex items-center gap-6 px-4 border-b border-[#1F2A33] overflow-x-auto">
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#E6EEF5] border-b-2 border-[#2DD4BF] whitespace-nowrap" data-category="All">All</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Perps">Perps</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Spot">Spot</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Crypto">Crypto</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Tradfi">Tradfi</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="HIP-3">HIP-3</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Trending">Trending</button>
                                    <button class="category-tab py-3 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Pre-launch">Pre-launch</button>
                                </div>

                                <!-- Table Header - COMPLETELY REBUILT for perfect alignment -->
                                <div class="px-4 py-3 border-b border-[#1F2A33] bg-[#0B131A]">
                                    <div class="grid grid-cols-[24px_1fr_100px_90px_85px_90px_110px] gap-4 items-center text-[11px] font-bold uppercase tracking-wider text-[#6B7C8B]">
                                        <div></div>
                                        <div class="text-left">Symbol</div>
                                        <div class="text-right">Last Price</div>
                                        <div class="text-right">24H Change</div>
                                        <div class="text-right">8H Funding</div>
                                        <div class="text-right">Volume</div>
                                        <div class="text-right">Open Interest</div>
                                    </div>
                                </div>

                                <!-- Pairs List Container -->
                                <div id="pairs-list-container" class="max-h-96 overflow-y-auto">
                                    <!-- Dynamically populated by JavaScript with EXACT SAME grid structure -->
                                </div>

                                <!-- Keyboard Shortcuts Footer -->
                                <div class="px-4 py-2 border-t border-[#1F2A33] bg-[#0B131A] flex items-center justify-between text-[11px] text-[#6B7C8B]">
                                    <div class="flex items-center gap-4">
                                        <div class="flex items-center gap-1">
                                            <kbd class="px-1.5 py-0.5 bg-[#121F29] border border-[#1F2A33] rounded text-[11px]">↑</kbd>
                                            <kbd class="px-1.5 py-0.5 bg-[#121F29] border border-[#1F2A33] rounded text-[11px]">↓</kbd>
                                            <span class="ml-1">Navigate</span>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <kbd class="px-1.5 py-0.5 bg-[#121F29] border border-[#1F2A33] rounded text-[11px]">Enter</kbd>
                                            <span class="ml-1">Select</span>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <kbd class="px-1.5 py-0.5 bg-[#121F29] border border-[#1F2A33] rounded text-[11px]">Esc</kbd>
                                            <span class="ml-1">Close</span>
                                        </div>
                                    </div>
                                    <div class="text-[#9FB0BF] font-medium">
                                        <span id="pairs-count">25</span> pairs available
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-6 text-[13px] h-full py-4">
                            <div>
                                <div class="text-[#E6EEF5] font-medium font-mono">$25.842</div>
                                <div class="text-[#1FD38A] text-[11px] font-medium">+2.34%</div>
                            </div>
                            <div>
                                <div class="text-[#6B7C8B] text-[11px] font-semibold uppercase tracking-wider">24H VOLUME</div>
                                <div class="text-[#E6EEF5] font-medium font-mono">189.405K</div>
                            </div>
                            <div>
                                <div class="text-[#6B7C8B] text-[11px] font-semibold uppercase tracking-wider">MARKET CAP</div>
                                <div class="text-[#E6EEF5] font-medium font-mono">$824M</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RIGHT SECTION: Chart Controls -->
                    <div class="flex items-center gap-2 h-full py-4">

                    </div>
                </div>
            </div>

            <!-- CONTENT GRID - PERFECTLY ALIGNED -->
            <div class="flex-1 flex overflow-hidden">
                
                <!-- CHART AREA (Center) -->
                <div class="flex-1 flex flex-col border-r border-[#1F2A33]">
                    <!-- Chart Canvas with OHLC Display -->
                    <div class="flex-1 bg-[#0B131A] p-4 relative">
                        <!-- OHLC Data Display (Top Left) -->
                        <div id="ohlc-display" class="absolute top-6 left-6 z-10 text-[13px] font-mono">
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-[#6B7C8B]">O</span>
                                    <span id="ohlc-open" class="text-[#E6EEF5]">25.842</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[#6B7C8B]">H</span>
                                    <span id="ohlc-high" class="text-[#1FD38A]">27.123</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[#6B7C8B]">L</span>
                                    <span id="ohlc-low" class="text-[#E05858]">23.456</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[#6B7C8B]">C</span>
                                    <span id="ohlc-close" class="text-[#E6EEF5]">25.842</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- LEFT VERTICAL TOOLBAR (48px width) - Inside chart boundary -->
                        <div class="absolute top-16 left-2 flex-col w-12 bg-[#0F1B23] border border-[#1F2A33] rounded-lg z-20 py-2 flex">
                            <div class="flex flex-col items-center gap-2">
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Cursor">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Trendline">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="22" y1="2" x2="2" y2="22"></line>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Brush">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="m9.06 11.9 8.07-16.97a2.85 2.85 0 0 1 4 10.03l-8.06 8.08"></path>
                                        <path d="M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"></path>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Indicators">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="4 7 4 4 20 4 20 7"></polyline>
                                        <line x1="9" y1="20" x2="15" y2="20"></line>
                                        <line x1="12" y1="4" x2="12" y2="20"></line>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Emoji">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                        <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                        <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Ruler">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21.42 6.11a1 1 0 0 0-1.41 0l-12 12a1 1 0 0 0 1.41 1.41l12-12a1 1 0 0 0 0-1.42zm-9.9 9.9l-1.41 1.42m4.24-4.24l-1.41 1.41m4.24-4.24l-1.41 1.41"></path>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Magnet">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="m6 15-4-4 6.75-6.77a7.79 7.79 0 0 1 11 11L13 22l-4-4 6.39-6.36a2.14 2.14 0 0 0-3-3L6 15"></path>
                                        <path d="m5 8 4 4"></path>
                                        <path d="m12 15 4 4"></path>
                                    </svg>
                                </button>
                                <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Lock">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <canvas id="trading-chart" class="w-full h-full"></canvas>
                        
                        <!-- Volume Label (Bottom Left) -->
                        <div class="absolute bottom-16 left-6 text-[11px] text-[#6B7C8B] font-mono">
                            Volume <span id="current-volume" class="text-[#E6EEF5]">189.405K</span>
                        </div>
                        
                        <div id="chart-tooltip" class="absolute hidden bg-[#121F29] border border-[#1F2A33] rounded-lg px-3 py-2 text-xs pointer-events-none z-10">
                            <div class="space-y-1">
                                <div class="font-semibold text-[#9FB0BF]">Time: <span id="tooltip-time"></span></div>
                                <div class="text-[#1FD38A]">O: <span id="tooltip-open"></span></div>
                                <div class="text-[#22D3EE]">H: <span id="tooltip-high"></span></div>
                                <div class="text-[#E05858]">L: <span id="tooltip-low"></span></div>
                                <div class="text-[#E6EEF5]">C: <span id="tooltip-close"></span></div>
                                <div class="text-[#6B7C8B]">Vol: <span id="tooltip-volume"></span></div>
                            </div>
                        </div>
                    </div>

                    <!-- BOTTOM TIMEFRAME SELECTOR - Enhanced with Calendar Icon and Timestamp -->
                    <div class="h-10 border-t border-[#1F2A33] bg-[#0F1B23] flex items-center justify-between px-3 flex-shrink-0">
                        <!-- Left: Calendar Icon -->
                        <button class="flex items-center justify-center w-8 h-8 text-[#6B7C8B] hover:text-[#E6EEF5] hover:bg-[#121F29] rounded transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                        </button>

                        <!-- Center: Timeframe Buttons -->
                        <div class="flex items-center gap-0.5">
                            <button class="long-timeframe-btn px-2.5 py-1 text-[10px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] hover:bg-[#121F29] rounded transition-colors" data-period="5y">5Y</button>
                            <button class="long-timeframe-btn px-2.5 py-1 text-[10px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] hover:bg-[#121F29] rounded transition-colors" data-period="1y">1Y</button>
                            <button class="long-timeframe-btn px-2.5 py-1 text-[10px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] hover:bg-[#121F29] rounded transition-colors" data-period="6m">6M</button>
                            <button class="long-timeframe-btn px-2.5 py-1 text-[10px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] hover:bg-[#121F29] rounded transition-colors" data-period="3m">3M</button>
                            <button class="long-timeframe-btn px-2.5 py-1 text-[10px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] hover:bg-[#121F29] rounded transition-colors" data-period="1m">1M</button>
                            <button class="long-timeframe-btn active px-2.5 py-1 text-[10px] font-semibold text-[#E6EEF5] bg-[#121F29] rounded" data-period="1d">1D</button>
                        </div>

                        <!-- Right: Timestamp Display -->
                        <div class="text-[10px] font-mono text-[#6B7C8B]" id="chart-timestamp">
                            11:11:56 UTC
                        </div>
                    </div>

                    <!-- BOTTOM ACCOUNT PANEL (160px height) -->
                    <div class="h-40 border-t border-[#1F2A33] bg-[#0F1B23] flex-shrink-0">
                        <div class="flex items-center gap-6 px-6 py-2 border-b border-[#1F2A33]">
                            <button class="text-[11px] font-semibold text-[#E6EEF5] py-2 border-b-2 border-[#2DD4BF]">Balances</button>
                            <button class="text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] py-2 transition-colors">Positions</button>
                            <button class="text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] py-2 transition-colors">Open Orders</button>
                            <button class="text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] py-2 transition-colors">Trade History</button>
                            <button class="text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] py-2 transition-colors">Funding History</button>
                            <button class="text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] py-2 transition-colors">Order History</button>
                        </div>
                        <div class="px-6 py-8 text-center text-[#465564] text-[13px]">
                            No open positions
                        </div>
                    </div>
                </div>

                <!-- RIGHT PANEL (360px width) - Split into Order Book and Trading Panel - PERFECTLY ALIGNED -->
                <div class="w-[360px] bg-[#0F1B23] flex flex-shrink-0">
                    
                    <!-- ORDER BOOK (Left Side - 180px) - PERFECTLY ALIGNED TOP -->
                    <div class="w-[180px] flex flex-col border-r border-[#1F2A33]">
                        <!-- Header with Tabs and Controls - SAME HEIGHT AS CHART TOP -->
                        <div class="px-3 py-3 border-b border-[#1F2A33] flex-shrink-0">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex gap-3">
                                    <button class="orderbook-tab text-[10px] font-semibold text-[#E6EEF5] border-b-2 border-[#2DD4BF] pb-1" data-tab="orderbook">Order Book</button>
                                    <button class="orderbook-tab text-[10px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] pb-1 transition-colors" data-tab="trades">Trades</button>
                                </div>
                                <button class="flex items-center justify-center w-5 h-5 text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="1"></circle>
                                        <circle cx="12" cy="5" r="1"></circle>
                                        <circle cx="12" cy="19" r="1"></circle>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Dropdowns Row -->
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <button class="w-full h-6 px-2 bg-[#121F29] border border-[#1F2A33] rounded text-[10px] text-[#E6EEF5] font-mono flex items-center justify-between hover:border-[#2DD4BF] transition-colors">
                                        <span>0.001</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 9l6 6 6-6"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="relative flex-1">
                                    <button class="w-full h-6 px-2 bg-[#121F29] border border-[#1F2A33] rounded text-[10px] text-[#E6EEF5] font-semibold flex items-center justify-between hover:border-[#2DD4BF] transition-colors">
                                        <span>HYPE</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 9l6 6 6-6"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order book container -->
                        <div class="flex-1 flex flex-col overflow-hidden" style="max-height: calc(100vh - 3.5rem - 72px - 10px - 160px);">
                            <!-- Sell Orders (Asks) - Top Half - RED -->
                            <div class="flex-1 flex flex-col overflow-hidden">
                                <div class="grid grid-cols-3 gap-1 text-[9px] text-[#6B7C8B] font-semibold uppercase tracking-wider px-2 py-1 flex-shrink-0">
                                    <div class="text-left">Price</div>
                                    <div class="text-right">Size (HYPE)</div>
                                    <div class="text-right">Total (HYPE)</div>
                                </div>
                                <div class="flex-1 overflow-y-auto px-2" id="sell-orders-container">
                                    <div class="space-y-0.5 font-mono text-[10px] font-medium" id="sell-orders">
                                        <!-- Dynamically populated -->
                                    </div>
                                </div>
                            </div>

                            <!-- SPREAD DIVIDER (32px height) - Fixed between halves -->
                            <div class="h-8 px-2 border-y border-[#1F2A33] flex items-center justify-between bg-[#121F29] flex-shrink-0">
                                <span class="text-[12px] font-medium font-mono text-[#E6EEF5]">25.842</span>
                                <div class="flex items-center gap-1">
                                    <span class="text-[10px] text-[#1FD38A]">↑</span>
                                    <span class="text-[9px] text-[#1FD38A]">0.015</span>
                                    <span class="text-[9px] text-[#6B7C8B]">(0.059%)</span>
                                </div>
                            </div>

                            <!-- Buy Orders (Bids) - Bottom Half - GREEN -->
                            <div class="flex-1 flex flex-col overflow-hidden">
                                <div class="flex-1 overflow-y-auto px-2" id="buy-orders-container">
                                    <div class="space-y-0.5 font-mono text-[10px] font-medium pt-1" id="buy-orders">
                                        <!-- Dynamically populated -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TRADING PANEL (Right Side - 180px) - PERFECTLY ALIGNED TOP -->
                    <div class="w-[180px] flex flex-col">
                        <!-- Tabs - ALIGNED WITH ORDER BOOK TOP -->
                        <div class="flex border-b border-[#1F2A33] h-[42px] flex-shrink-0">
                            <button class="flex-1 text-[11px] font-semibold text-[#E6EEF5] border-b-2 border-[#2DD4BF]">Market</button>
                            <button class="flex-1 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors">Limit</button>
                            <button class="flex-1 text-[11px] font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors">Pro</button>
                        </div>

                        <!-- Trading Controls -->
                        <div class="flex-1 p-3 space-y-3 overflow-y-auto">
                            <!-- Buy/Sell Toggle -->
                            <div class="flex gap-1">
                                <button class="flex-1 h-7 bg-[rgba(31,211,138,0.15)] text-[#1FD38A] text-[11px] font-semibold rounded">Buy</button>
                                <button class="flex-1 h-7 bg-transparent text-[#6B7C8B] hover:text-[#E6EEF5] text-[11px] font-semibold border border-[#1F2A33] rounded transition-colors">Sell</button>
                            </div>

                            <!-- Available Balance -->
                            <div class="flex justify-between text-[9px]">
                                <span class="text-[#6B7C8B]">Available</span>
                                <span class="text-[#E6EEF5] font-medium font-mono">0.00 USDC</span>
                            </div>

                            <!-- Size Input -->
                            <div>
                                <label class="block text-[9px] text-[#6B7C8B] font-semibold uppercase tracking-wider mb-1">SIZE</label>
                                <div class="bg-[#121F29] border border-[#1F2A33] rounded px-2 py-1.5">
                                    <input type="text" placeholder="0.00" class="bg-transparent w-full outline-none font-mono text-[11px] text-[#E6EEF5]">
                                </div>
                            </div>

                            <!-- Slider -->
                            <div class="relative h-1.5 bg-[#23313B] rounded-full">
                                <div class="absolute inset-0 bg-[#2DD4BF] rounded-full" style="width: 0%"></div>
                                <div class="absolute w-2.5 h-2.5 bg-[#2DD4BF] rounded-full shadow-lg" style="left: 0%; transform: translateX(-50%)"></div>
                            </div>

                            <!-- Percentage Buttons -->
                            <div class="grid grid-cols-4 gap-1">
                                <button class="py-1 text-[9px] text-[#9FB0BF] hover:text-[#E6EEF5] border border-[#1F2A33] rounded transition-colors">25%</button>
                                <button class="py-1 text-[9px] text-[#9FB0BF] hover:text-[#E6EEF5] border border-[#1F2A33] rounded transition-colors">50%</button>
                                <button class="py-1 text-[9px] text-[#9FB0BF] hover:text-[#E6EEF5] border border-[#1F2A33] rounded transition-colors">75%</button>
                                <button class="py-1 text-[9px] text-[#9FB0BF] hover:text-[#E6EEF5] border border-[#1F2A33] rounded transition-colors">100%</button>
                            </div>

                            <!-- Slippage & Fees -->
                            <div class="space-y-1">
                                <div class="flex justify-between text-[9px]">
                                    <span class="text-[#6B7C8B]">Slippage</span>
                                    <span class="text-[#E6EEF5] font-medium font-mono">0.5%</span>
                                </div>
                                <div class="flex justify-between text-[9px]">
                                    <span class="text-[#6B7C8B]">Fees</span>
                                    <span class="text-[#E6EEF5] font-medium font-mono">~$0.00</span>
                                </div>
                            </div>

                            <!-- Primary CTA -->
                            <button class="w-full h-8 bg-[#2DD4BF] hover:bg-[#22D3EE] text-[#0B131A] text-[11px] font-bold rounded transition-all">
                                Buy HYPE
                            </button>

                            <!-- Account Information -->
                            <div class="pt-3 border-t border-[#1F2A33] space-y-1.5">
                                <div class="flex justify-between text-[9px]">
                                    <span class="text-[#6B7C8B]">Total Balance</span>
                                    <span class="text-[#E6EEF5] font-medium font-mono">$0.00</span>
                                </div>
                                <div class="flex justify-between text-[9px]">
                                    <span class="text-[#6B7C8B]">Open Positions</span>
                                    <span class="text-[#E6EEF5] font-medium font-mono">0</span>
                                </div>
                                <div class="flex justify-between text-[9px]">
                                    <span class="text-[#6B7C8B]">P&L (24h)</span>
                                    <span class="text-[#1FD38A] font-medium font-mono">+$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MOBILE LAYOUT -->
    <div class="lg:hidden flex flex-col" style="height: calc(100vh - 3.5rem - 60px);">
        <!-- Mobile Market Header with Trading Pair Dropdown -->
        <div class="relative h-16 border-b border-[#1F2A33] px-4 flex items-center justify-between bg-[#0F1B23] flex-shrink-0">
            <div class="flex-1">
                <button id="mobile-market-pair-btn" class="flex items-center gap-2 mb-1 hover:bg-[#121F29] px-2 py-1 -ml-2 rounded-lg transition-colors">
                    <span class="text-base font-semibold">HYPE/USDC</span>
                    <span class="text-xs px-1.5 py-0.5 bg-[rgba(31,211,138,0.15)] text-[#1FD38A] rounded font-semibold">SPOT</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-[#6B7C8B]">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <div class="flex items-center gap-2" id="mobile-price-display">
                    <span class="text-lg font-mono font-semibold">$25.842</span>
                    <span class="text-sm text-[#1FD38A]">+2.34%</span>
                </div>
            </div>
            <button class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>

            <!-- Mobile Trading Pairs Dropdown -->
            <div id="mobile-market-pair-dropdown" class="hidden absolute top-full left-0 right-0 mt-0 bg-[#0F1B23] border-b border-[#1F2A33] shadow-xl z-50 max-h-[70vh] overflow-y-auto">
                <!-- Search Bar -->
                <div class="p-3 border-b border-[#1F2A33]">
                    <div class="relative">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#6B7C8B]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <input id="mobile-market-search-input" type="text" placeholder="Search pairs..." class="w-full bg-[#121F29] border border-[#1F2A33] rounded-lg pl-10 pr-3 py-2 text-sm text-[#E6EEF5] outline-none focus:border-[#2DD4BF] transition-colors">
                    </div>
                </div>

                <!-- Category Tabs -->
                <div class="flex items-center gap-4 px-3 border-b border-[#1F2A33] overflow-x-auto no-scrollbar sticky top-[60px] bg-[#0F1B23] z-10">
                    <button class="mobile-category-tab py-3 text-xs font-semibold text-[#E6EEF5] border-b-2 border-[#2DD4BF] whitespace-nowrap" data-category="All">All</button>
                    <button class="mobile-category-tab py-3 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Perps">Perps</button>
                    <button class="mobile-category-tab py-3 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Spot">Spot</button>
                    <button class="mobile-category-tab py-3 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Crypto">Crypto</button>
                    <button class="mobile-category-tab py-3 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Tradfi">Tradfi</button>
                    <button class="mobile-category-tab py-3 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] transition-colors whitespace-nowrap" data-category="Trending">Trending</button>
                </div>

                <!-- Pairs List Container -->
                <div id="mobile-pairs-list-container">
                    <!-- Dynamically populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Mobile Tab Selector -->
        <div class="flex border-b border-[#1F2A33] bg-[#0F1B23] flex-shrink-0">
            <button class="mobile-content-tab flex-1 py-3 text-sm font-semibold text-[#2DD4BF] border-b-2 border-[#2DD4BF]" data-content="chart">
                Chart
            </button>
            <button class="mobile-content-tab flex-1 py-3 text-sm font-semibold text-[#6B7C8B]" data-content="orderbook">
                Order Book
            </button>
            <button class="mobile-content-tab flex-1 py-3 text-sm font-semibold text-[#6B7C8B]" data-content="trades">
                Trades
            </button>
        </div>

        <!-- Mobile Content Container -->
        <div class="flex-1 relative min-h-0">
            <!-- Chart Tab Content -->
            <div id="mobile-chart-content" class="absolute inset-0 flex flex-col">
                <div class="flex-1 bg-[#0B131A] relative min-h-0">
                    <!-- Left Toolbar for Mobile -->
                    <div class="absolute top-4 left-2 flex flex-col w-10 bg-[#0F1B23] border border-[#1F2A33] rounded-lg z-20 py-1.5">
                        <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Cursor">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path>
                            </svg>
                        </button>
                        <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Trendline">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="2" y2="22"></line>
                            </svg>
                        </button>
                        <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Indicators">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </button>
                        <button class="w-full h-9 flex items-center justify-center text-[#6B7C8B]" title="Settings">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6l4 2"></path>
                            </svg>
                        </button>
                    </div>
                    <canvas id="mobile-trading-chart" class="w-full h-full"></canvas>
                </div>

                <!-- Mobile Timeframe Controls -->
                <div class="h-12 border-t border-[#1F2A33] bg-[#0F1B23] flex items-center px-3 flex-shrink-0">
                    <div class="flex items-center gap-1 overflow-x-auto no-scrollbar flex-1">
                        <button class="mobile-timeframe-btn px-3 py-1.5 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] whitespace-nowrap" data-tf="5m">5m</button>
                        <button class="mobile-timeframe-btn px-3 py-1.5 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] whitespace-nowrap" data-tf="15m">15m</button>
                        <button class="mobile-timeframe-btn px-3 py-1.5 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] whitespace-nowrap" data-tf="1h">1H</button>
                        <button class="mobile-timeframe-btn active px-3 py-1.5 text-xs font-semibold text-[#E6EEF5] bg-[#121F29] rounded whitespace-nowrap" data-tf="4h">4H</button>
                        <button class="mobile-timeframe-btn px-3 py-1.5 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] whitespace-nowrap" data-tf="1d">1D</button>
                        <button class="mobile-timeframe-btn px-3 py-1.5 text-xs font-semibold text-[#6B7C8B] hover:text-[#E6EEF5] whitespace-nowrap" data-tf="1w">1W</button>
                    </div>
                </div>

                <!-- Mobile Volume Section -->
                <div class="h-16 border-t border-[#1F2A33] bg-[#0F1B23] px-4 flex-shrink-0">
                    <div class="flex items-center justify-between h-full">
                        <div>
                            <div class="text-xs text-[#6B7C8B] mb-0.5">24H Volume</div>
                            <div class="text-sm font-mono font-semibold">2.45M USDC</div>
                        </div>
                        <div>
                            <div class="text-xs text-[#6B7C8B] mb-0.5">24H High</div>
                            <div class="text-sm font-mono font-semibold text-[#1FD38A]">$44,123</div>
                        </div>
                        <div>
                            <div class="text-xs text-[#6B7C8B] mb-0.5">24H Low</div>
                            <div class="text-sm font-mono font-semibold text-[#E05858]">$42,456</div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Positions Tab -->
                <div class="h-48 border-t border-[#1F2A33] bg-[#0F1B23] flex-shrink-0">
                    <div class="flex items-center justify-between px-4 py-3 border-b border-[#1F2A33] overflow-x-auto">
                        <div class="flex items-center gap-4">
                            <button class="mobile-position-tab text-xs font-semibold text-[#E6EEF5] pb-1 border-b-2 border-[#2DD4BF] whitespace-nowrap" data-pos="positions">Positions</button>
                            <button class="mobile-position-tab text-xs font-semibold text-[#6B7C8B] pb-1 whitespace-nowrap" data-pos="openorders">Open Orders</button>
                            <button class="mobile-position-tab text-xs font-semibold text-[#6B7C8B] pb-1 whitespace-nowrap" data-pos="twap">TWAP</button>
                            <button class="mobile-position-tab text-xs font-semibold text-[#6B7C8B] pb-1 whitespace-nowrap" data-pos="tradehistory">Trade History</button>
                        </div>
                    </div>
                    <div class="px-4 py-8 text-center text-[#465564] text-sm">
                        No open positions
                    </div>
                </div>
            </div>

            <!-- Order Book Tab Content (Hidden initially) -->
            <div id="mobile-orderbook-content" class="hidden absolute inset-0 bg-[#0B131A] overflow-y-auto flex flex-col">
                <!-- Mobile Order Book Header -->
                <div class="px-4 py-3 border-b border-[#1F2A33] bg-[#0F1B23] flex-shrink-0">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex gap-3">
                            <button class="mobile-orderbook-tab text-xs font-semibold text-[#E6EEF5] border-b-2 border-[#2DD4BF] pb-1" data-tab="book">Book</button>
                            <button class="mobile-orderbook-tab text-xs font-semibold text-[#6B7C8B] pb-1" data-tab="trades">Trades</button>
                        </div>
                        <button class="flex items-center justify-center w-6 h-6 text-[#6B7C8B]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Mobile Order Book List -->
                <div class="flex-1 flex flex-col overflow-hidden">
                    <!-- Sell Orders -->
                    <div class="flex-1 overflow-y-auto">
                        <div class="grid grid-cols-3 gap-2 text-[10px] text-[#6B7C8B] font-semibold px-4 py-2 border-b border-[#1F2A33]">
                            <div class="text-left">Price</div>
                            <div class="text-right">Size</div>
                            <div class="text-right">Total</div>
                        </div>
                        <div id="mobile-sell-orders" class="px-4 py-2"></div>
                    </div>

                    <!-- Spread -->
                    <div class="h-12 px-4 border-y border-[#1F2A33] flex items-center justify-between bg-[#121F29] flex-shrink-0">
                        <span class="text-sm font-medium font-mono text-[#E6EEF5]">25.842</span>
                        <div class="flex items-center gap-1">
                            <span class="text-xs text-[#1FD38A]">↑</span>
                            <span class="text-xs text-[#1FD38A]">0.015</span>
                            <span class="text-xs text-[#6B7C8B]">(0.059%)</span>
                        </div>
                    </div>

                    <!-- Buy Orders -->
                    <div class="flex-1 overflow-y-auto">
                        <div id="mobile-buy-orders" class="px-4 py-2"></div>
                    </div>
                </div>
            </div>

            <!-- Trades Tab Content (Hidden initially) -->
            <div id="mobile-trades-content" class="hidden absolute inset-0 bg-[#0B131A] overflow-y-auto flex flex-col">
                <div class="px-4 py-3 border-b border-[#1F2A33]">
                    <div class="grid grid-cols-3 gap-2 text-[10px] text-[#6B7C8B] font-semibold">
                        <div class="text-left">Price</div>
                        <div class="text-right">Size</div>
                        <div class="text-right">Time</div>
                    </div>
                </div>
                <div class="flex-1 px-4 py-8 text-center text-[#465564] text-sm">
                    Recent trades will appear here
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 lg:hidden border-t border-[#1F2A33] bg-[#0F1B23] z-30">
        <div class="grid grid-cols-3 divide-x divide-[#1F2A33]">
            <button class="mobile-nav-btn py-3 text-xs font-semibold text-[#2DD4BF] bg-[rgba(45,212,191,0.05)]" data-nav="markets">
                <div class="flex flex-col items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                    <span>Markets</span>
                </div>
            </button>
            <button class="mobile-nav-btn py-3 text-xs font-semibold text-[#6B7C8B]" data-nav="trade">
                <div class="flex flex-col items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                    <span>Trade</span>
                </div>
            </button>
            <button class="mobile-nav-btn py-3 text-xs font-semibold text-[#6B7C8B]" data-nav="account">
                <div class="flex flex-col items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                    <span>Account</span>
                </div>
            </button>
        </div>
    </div>
</section>

    <!-- Main JavaScript with Fixed Chart Padding Configuration -->
    <script>
        // COMPLETELY REWRITTEN Configuration - FIXED for proper fullscreen display
        const CONFIG = {
            candleWidth: 6,
            candleGap: 2,
            volumeHeight: 80,
            chartPadding: {
                top: 80,
                right: 45,  // OPTIMIZED for price axis visibility
                bottom: 100,
                left: 70
            },
            mobilePadding: {
                top: 40,
                right: 35,  // OPTIMIZED for mobile price axis
                bottom: 60,
                left: 40
            },
            colors: {
                bgPrimary: '#0B131A',
                bgPanel: '#0F1B23',
                bgElevated: '#121F29',
                borderSubtle: '#1F2A33',
                borderDivider: '#23313B',
                textPrimary: '#E6EEF5',
                textSecondary: '#9FB0BF',
                textMuted: '#6B7C8B',
                marketGreen: '#1FD38A',
                marketRed: '#E05858',
                accentTeal: '#2DD4BF',
                accentCyan: '#22D3EE',
                gridLineHorizontal: '#1F2A33',
                gridLineVertical: 'rgba(31, 42, 51, 0.2)'
            }
        };

        // Enhanced Market Pairs Data
        const marketPairsData = [
            { symbol: 'HYPE/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto', 'Trending'], lastPrice: 25.842, change24h: 2.34, funding8h: null, volume: 189405, openInterest: null, favorite: false },
            { symbol: 'BTC/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto', 'Trending'], lastPrice: 43821.50, change24h: -1.23, funding8h: 0.0082, volume: 2456789, openInterest: 892456, favorite: true },
            { symbol: 'ETH/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto', 'Trending'], lastPrice: 2456.78, change24h: 3.45, funding8h: 0.0095, volume: 1234567, openInterest: 456789, favorite: true },
            { symbol: 'SOL/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 98.45, change24h: 5.67, funding8h: null, volume: 567890, openInterest: null, favorite: false },
            { symbol: 'DOGE/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 0.0845, change24h: -2.34, funding8h: 0.0067, volume: 345678, openInterest: 234567, favorite: false },
            { symbol: 'AAPL/USD', type: 'Perp', category: ['All', 'Perps', 'Tradfi'], lastPrice: 178.23, change24h: 1.89, funding8h: 0.0023, volume: 123456, openInterest: 89012, favorite: false },
            { symbol: 'TSLA/USD', type: 'Perp', category: ['All', 'Perps', 'Tradfi'], lastPrice: 234.56, change24h: -3.21, funding8h: 0.0034, volume: 98765, openInterest: 67890, favorite: false },
            { symbol: 'XRP/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 0.5432, change24h: 4.56, funding8h: 0.0078, volume: 456789, openInterest: 345678, favorite: false },
            { symbol: 'ADA/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 0.3456, change24h: 2.78, funding8h: null, volume: 234567, openInterest: null, favorite: false },
            { symbol: 'MATIC/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 0.8765, change24h: -1.45, funding8h: 0.0056, volume: 345678, openInterest: 234567, favorite: false },
            { symbol: 'AVAX/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 34.56, change24h: 6.78, funding8h: null, volume: 123456, openInterest: null, favorite: false },
            { symbol: 'DOT/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 6.789, change24h: 3.21, funding8h: 0.0089, volume: 234567, openInterest: 178901, favorite: false },
            { symbol: 'LINK/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 14.567, change24h: 1.23, funding8h: null, volume: 145678, openInterest: null, favorite: false },
            { symbol: 'UNI/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 5.432, change24h: -2.34, funding8h: 0.0067, volume: 123456, openInterest: 89012, favorite: false },
            { symbol: 'ATOM/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 9.876, change24h: 4.56, funding8h: null, volume: 98765, openInterest: null, favorite: false },
            { symbol: 'HBAR/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto', 'HIP-3'], lastPrice: 0.0567, change24h: 8.90, funding8h: 0.0045, volume: 567890, openInterest: 345678, favorite: false },
            { symbol: 'ALGO/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 0.1234, change24h: 2.34, funding8h: null, volume: 123456, openInterest: null, favorite: false },
            { symbol: 'FTM/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 0.3456, change24h: -1.23, funding8h: 0.0078, volume: 234567, openInterest: 178901, favorite: false },
            { symbol: 'NEAR/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 1.789, change24h: 5.67, funding8h: null, volume: 145678, openInterest: null, favorite: false },
            { symbol: 'APT/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto', 'Trending'], lastPrice: 8.901, change24h: 12.34, funding8h: 0.0123, volume: 456789, openInterest: 345678, favorite: true },
            { symbol: 'SUI/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto', 'Pre-launch'], lastPrice: 0.9876, change24h: 15.67, funding8h: null, volume: 234567, openInterest: null, favorite: false },
            { symbol: 'ARB/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto'], lastPrice: 1.234, change24h: -3.45, funding8h: 0.0067, volume: 345678, openInterest: 234567, favorite: false },
            { symbol: 'OP/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto'], lastPrice: 2.345, change24h: 4.56, funding8h: null, volume: 123456, openInterest: null, favorite: false },
            { symbol: 'INJ/USDT', type: 'Perp', category: ['All', 'Perps', 'Crypto', 'Trending'], lastPrice: 34.567, change24h: 8.90, funding8h: 0.0098, volume: 567890, openInterest: 456789, favorite: false },
            { symbol: 'TIA/USDC', type: 'Spot', category: ['All', 'Spot', 'Crypto', 'Pre-launch'], lastPrice: 5.678, change24h: 23.45, funding8h: null, volume: 345678, openInterest: null, favorite: false }
        ];

        // Enhanced Order Book Data
        const orderBookData = {
            sellOrders: [
                { price: 26.987, size: 0.234, total: 6.319 },
                { price: 26.923, size: 0.891, total: 23.984 },
                { price: 26.845, size: 0.567, total: 15.221 },
                { price: 26.789, size: 1.456, total: 39.005 },
                { price: 26.723, size: 1.123, total: 30.006 },
                { price: 26.678, size: 2.234, total: 59.599 },
                { price: 26.612, size: 0.891, total: 23.711 },
                { price: 26.556, size: 1.678, total: 44.561 },
                { price: 26.498, size: 2.345, total: 62.138 },
                { price: 26.445, size: 0.923, total: 24.409 },
                { price: 26.401, size: 1.567, total: 41.371 },
                { price: 26.354, size: 0.678, total: 17.868 },
                { price: 26.298, size: 2.123, total: 55.831 },
                { price: 26.234, size: 1.456, total: 38.197 },
                { price: 26.189, size: 0.789, total: 20.663 },
                { price: 26.145, size: 1.901, total: 49.704 },
                { price: 26.123, size: 0.234, total: 6.113 },
                { price: 26.089, size: 1.345, total: 35.090 },
                { price: 26.045, size: 0.567, total: 14.219 },
                { price: 26.012, size: 3.567, total: 92.765 },
                { price: 25.976, size: 1.234, total: 30.988 },
                { price: 25.934, size: 0.567, total: 14.219 },
                { price: 25.901, size: 1.678, total: 42.846 },
                { price: 25.867, size: 2.345, total: 60.659 },
                { price: 25.843, size: 0.456, total: 11.784 }
            ],
            buyOrders: [
                { price: 25.842, size: 1.234, total: 31.889 },
                { price: 25.812, size: 0.567, total: 14.635 },
                { price: 25.778, size: 1.891, total: 48.746 },
                { price: 25.734, size: 2.567, total: 66.059 },
                { price: 25.689, size: 0.923, total: 23.711 },
                { price: 25.645, size: 1.456, total: 37.125 },
                { price: 25.612, size: 0.891, total: 22.553 },
                { price: 25.567, size: 2.234, total: 57.117 },
                { price: 25.534, size: 1.678, total: 42.846 },
                { price: 25.498, size: 1.456, total: 37.125 },
                { price: 25.456, size: 0.789, total: 20.085 },
                { price: 25.423, size: 2.123, total: 53.973 },
                { price: 25.387, size: 3.234, total: 82.102 },
                { price: 25.345, size: 1.567, total: 39.716 },
                { price: 25.312, size: 0.891, total: 22.553 },
                { price: 25.276, size: 0.678, total: 17.137 },
                { price: 25.234, size: 1.901, total: 47.970 },
                { price: 25.198, size: 2.345, total: 59.089 },
                { price: 25.154, size: 2.789, total: 70.155 },
                { price: 25.112, size: 1.234, total: 30.988 },
                { price: 25.078, size: 0.567, total: 14.219 },
                { price: 25.043, size: 1.123, total: 28.123 },
                { price: 25.001, size: 0.891, total: 22.276 },
                { price: 24.967, size: 1.456, total: 36.352 },
                { price: 24.932, size: 0.456, total: 11.369 }
            ]
        };

        // CRITICAL FIX: Market Data Manager - Enhanced mobile header update logic
        class MarketDataManager {
            constructor() {
                this.currentPrice = 25.842;
                this.change24h = 2.34;
                this.volume24h = 189405;
                this.marketCap = 824000000;
                this.previousPrice = this.currentPrice;
                this.init();
            }

            init() {
                // Start price fluctuation updates
                this.startPriceFluctuations();
            }

            startPriceFluctuations() {
                // Update prices every 800ms for realistic market feel
                setInterval(() => {
                    this.updateMarketData();
                    this.renderMarketHeader();
                }, 800);

                // Larger price movements every 3 seconds
                setInterval(() => {
                    this.applyLargePriceMovement();
                }, 3000);
            }

            updateMarketData() {
                // Store previous price for direction indication
                this.previousPrice = this.currentPrice;

                // Realistic micro price movement (±0.005 to ±0.02)
                const microMovement = (Math.random() - 0.5) * 0.04;
                this.currentPrice += microMovement;

                // Keep price within reasonable bounds (23.0 to 28.0)
                this.currentPrice = Math.max(23.0, Math.min(28.0, this.currentPrice));

                // Calculate actual 24h change percentage
                const basePrice = 25.242; // Starting price reference
                this.change24h = ((this.currentPrice - basePrice) / basePrice) * 100;

                // Volume fluctuation (±0.5% to ±2%)
                const volumeChange = 1 + (Math.random() - 0.5) * 0.04;
                this.volume24h *= volumeChange;
                this.volume24h = Math.max(150000, Math.min(250000, this.volume24h));

                // Market cap follows price with slight variance
                const marketCapBase = 800000000;
                const priceRatio = this.currentPrice / 25.842;
                this.marketCap = marketCapBase * priceRatio * (1 + (Math.random() - 0.5) * 0.02);
            }

            applyLargePriceMovement() {
                // 30% chance of larger price movement
                if (Math.random() > 0.7) {
                    const largeMovement = (Math.random() - 0.5) * 0.15;
                    this.currentPrice += largeMovement;
                    this.currentPrice = Math.max(23.0, Math.min(28.0, this.currentPrice));
                }
            }

            renderMarketHeader() {
                // Desktop market header - find the price element in the market stats section
                const desktopMarketStats = document.querySelector('.h-\\[72px\\] .flex.items-center.gap-6.text-\\[13px\\]');
                if (desktopMarketStats) {
                    const priceDiv = desktopMarketStats.querySelector('div:first-child > div:first-child');
                    if (priceDiv) {
                        priceDiv.textContent = `$${this.currentPrice.toFixed(3)}`;
                        
                        // Add price flash animation
                        const isUp = this.currentPrice > this.previousPrice;
                        const isDown = this.currentPrice < this.previousPrice;
                        
                        if (isUp || isDown) {
                            priceDiv.style.transition = 'color 0.3s ease';
                            priceDiv.style.color = isUp ? '#1FD38A' : '#E05858';
                            
                            setTimeout(() => {
                                priceDiv.style.color = '#E6EEF5';
                            }, 300);
                        }
                    }
                    
                    // Update change percentage
                    const changeDiv = desktopMarketStats.querySelector('div:first-child > div:last-child');
                    if (changeDiv) {
                        const isPositive = this.change24h >= 0;
                        changeDiv.textContent = `${isPositive ? '+' : ''}${this.change24h.toFixed(2)}%`;
                        changeDiv.className = `${isPositive ? 'text-[#1FD38A]' : 'text-[#E05858]'} text-[11px] font-medium`;
                    }
                    
                    // Update volume (second div)
                    const volumeDiv = desktopMarketStats.querySelector('div:nth-child(2) > div:last-child');
                    if (volumeDiv) {
                        volumeDiv.textContent = `${(this.volume24h / 1000).toFixed(3)}K`;
                    }
                    
                    // Update market cap (third div)
                    const marketCapDiv = desktopMarketStats.querySelector('div:nth-child(3) > div:last-child');
                    if (marketCapDiv) {
                        marketCapDiv.textContent = `$${(this.marketCap / 1000000).toFixed(0)}M`;
                    }
                }

                // CRITICAL FIX: Enhanced mobile market header update using specific IDs
                const mobilePriceDisplay = document.getElementById('mobile-price-display');
                if (mobilePriceDisplay) {
                    // Find the price element (first span in the container)
                    const mobilePriceElement = mobilePriceDisplay.querySelector('span:first-child');
                    if (mobilePriceElement) {
                        mobilePriceElement.textContent = `$${this.currentPrice.toFixed(3)}`;
                        
                        // Add price flash animation for mobile
                        const isUp = this.currentPrice > this.previousPrice;
                        const isDown = this.currentPrice < this.previousPrice;
                        
                        if (isUp || isDown) {
                            mobilePriceElement.style.transition = 'color 0.3s ease';
                            mobilePriceElement.style.color = isUp ? '#1FD38A' : '#E05858';
                            
                            setTimeout(() => {
                                mobilePriceElement.style.color = '#E6EEF5';
                            }, 300);
                        }
                    }
                    
                    // Find the change percentage element (last span in the container)
                    const mobileChangeElement = mobilePriceDisplay.querySelector('span:last-child');
                    if (mobileChangeElement) {
                        const isPositive = this.change24h >= 0;
                        mobileChangeElement.textContent = `${isPositive ? '+' : ''}${this.change24h.toFixed(2)}%`;
                        mobileChangeElement.className = `text-sm ${isPositive ? 'text-[#1FD38A]' : 'text-[#E05858]'}`;
                    }
                }
            }

            getCurrentPrice() {
                return this.currentPrice;
            }
        }

        // COMPLETELY REWRITTEN Trading Chart Class - NOW with real-time data fluctuation
        class TradingChart {
            constructor(canvasId, isMobile = false) {
                this.canvas = document.getElementById(canvasId);
                if (!this.canvas) return;
                
                this.ctx = this.canvas.getContext('2d');
                this.data = [];
                this.timeframe = '1h';
                this.crosshair = { x: null, y: null };
                this.isMobile = isMobile;
                this.touchActive = false;
                this.marketDataManager = null; // Will be set from outside
                
                this.init();
            }

            init() {
                this.setupCanvas();
                this.generateData();
                this.setupEventListeners();
                this.draw();
                this.startRealTimeUpdates(); // NEW: Start continuous chart updates
            }

            // NEW: Real-time candlestick data updates
            startRealTimeUpdates() {
                // Update the most recent candle every 1 second
                setInterval(() => {
                    if (this.data.length > 0 && this.marketDataManager) {
                        this.updateLatestCandle();
                        this.draw();
                    }
                }, 1000);

                // Add new candle every 10 seconds for visual variety
                setInterval(() => {
                    this.addNewCandle();
                    this.draw();
                }, 10000);
            }

            // NEW: Update the most recent candle with live price data
            updateLatestCandle() {
                const latestCandle = this.data[this.data.length - 1];
                const currentPrice = this.marketDataManager.getCurrentPrice();
                
                // Update close price to current market price
                latestCandle.close = currentPrice;
                
                // Update high if current price exceeds it
                if (currentPrice > latestCandle.high) {
                    latestCandle.high = currentPrice;
                }
                
                // Update low if current price is below it
                if (currentPrice < latestCandle.low) {
                    latestCandle.low = currentPrice;
                }

                // Volume fluctuation (realistic trading volume changes)
                latestCandle.volume += (Math.random() - 0.5) * 20000;
                latestCandle.volume = Math.max(80000, Math.min(300000, latestCandle.volume));
            }

            // NEW: Add a new candle to simulate time progression
            addNewCandle() {
                const now = Date.now();
                const lastCandle = this.data[this.data.length - 1];
                
                // New candle starts where last one closed
                const open = lastCandle.close;
                const volatility = 0.3 + Math.random() * 0.5;
                
                // Generate realistic OHLC data
                const high = open + Math.random() * volatility;
                const low = open - Math.random() * volatility;
                const close = low + Math.random() * (high - low);
                const volume = 100000 + Math.random() * 150000;

                this.data.push({
                    time: now,
                    open,
                    high,
                    low,
                    close,
                    volume
                });

                // Keep only last 250 candles to prevent memory issues
                if (this.data.length > 250) {
                    this.data.shift();
                }
            }

            // CRITICAL FIX: Proper canvas sizing that accounts for ALL UI elements
            setupCanvas() {
                // FIXED: Get parent container's actual computed dimensions
                const container = this.canvas.parentElement;
                const containerRect = container.getBoundingClientRect();
                
                // CRITICAL: Calculate actual available space
                let availableWidth = containerRect.width;
                let availableHeight = containerRect.height;
                
                // For desktop, account for padding in parent container
                if (!this.isMobile) {
                    const computedStyle = window.getComputedStyle(container);
                    const paddingTop = parseFloat(computedStyle.paddingTop) || 0;
                    const paddingBottom = parseFloat(computedStyle.paddingBottom) || 0;
                    const paddingLeft = parseFloat(computedStyle.paddingLeft) || 0;
                    const paddingRight = parseFloat(computedStyle.paddingRight) || 0;
                    
                    availableWidth = availableWidth - paddingLeft - paddingRight;
                    availableHeight = availableHeight - paddingTop - paddingBottom;
                }
                
                // CRITICAL: Set canvas dimensions to exact available space
                const dpr = window.devicePixelRatio || 1;
                this.canvas.width = availableWidth * dpr;
                this.canvas.height = availableHeight * dpr;
                
                // Scale context for high DPI displays
                this.ctx.scale(dpr, dpr);
                
                // Store actual drawable dimensions
                this.width = availableWidth;
                this.height = availableHeight;
            }

            // CRITICAL FIX: Generate sufficient data points to fill entire chart width
            generateData() {
                const now = Date.now();
                const interval = 3600000; // 1 hour intervals
                let basePrice = 25.000;

                // FIXED: Calculate how many candles we need based on canvas width
                const padding = this.isMobile ? CONFIG.mobilePadding : CONFIG.chartPadding;
                const chartWidth = this.width - padding.left - padding.right;
                const candleFullWidth = CONFIG.candleWidth + CONFIG.candleGap;
                const maxPossibleCandles = Math.ceil(chartWidth / candleFullWidth);
                
                // Generate extra candles to ensure we always have enough data
                const dataPoints = Math.max(200, maxPossibleCandles + 50);
                
                console.log(`Generating ${dataPoints} candles for chart width ${chartWidth}px (max visible: ${maxPossibleCandles})`);

                this.data = []; // Clear existing data
                
                for (let i = dataPoints - 1; i >= 0; i--) {
                    const time = now - (i * interval);
                    const volatility = 0.5 + Math.random() * 1.0;
                    const trend = Math.sin(i / 10) * 0.3;
                    
                    basePrice += (Math.random() - 0.48) * volatility + trend;
                    basePrice = Math.max(23.0, Math.min(27.0, basePrice));
                    
                    const open = basePrice;
                    const high = open + Math.random() * volatility;
                    const low = open - Math.random() * volatility;
                    const close = low + Math.random() * (high - low);
                    const volume = 100000 + Math.random() * 200000;

                    this.data.push({ time, open, high, low, close, volume });
                }
            }

            setupEventListeners() {
                if (this.isMobile) {
                    // Mobile touch events for interactive chart
                    this.canvas.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: false });
                    this.canvas.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: false });
                    this.canvas.addEventListener('touchend', (e) => this.handleTouchEnd(e));
                    this.canvas.addEventListener('touchcancel', (e) => this.handleTouchEnd(e));
                } else {
                    // Desktop mouse events
                    this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                    this.canvas.addEventListener('mouseleave', () => this.handleMouseLeave());
                }
                window.addEventListener('resize', () => this.handleResize());
            }

            // NEW: Handle touch start for mobile
            handleTouchStart(e) {
                e.preventDefault();
                this.touchActive = true;
                const touch = e.touches[0];
                const rect = this.canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                this.crosshair.x = x;
                this.crosshair.y = y;
                this.draw();
                
                // Show price details on mobile
                this.showMobileTooltip(touch.clientX, touch.clientY);
            }

            // NEW: Handle touch move for mobile
            handleTouchMove(e) {
                e.preventDefault();
                if (!this.touchActive) return;
                
                const touch = e.touches[0];
                const rect = this.canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                this.crosshair.x = x;
                this.crosshair.y = y;
                this.draw();
                
                // Update price details on mobile
                this.showMobileTooltip(touch.clientX, touch.clientY);
            }

            // NEW: Handle touch end for mobile
            handleTouchEnd(e) {
                this.touchActive = false;
                // Keep the tooltip visible for 2 seconds after touch ends on mobile
                setTimeout(() => {
                    if (!this.touchActive) {
                        this.crosshair.x = null;
                        this.crosshair.y = null;
                        this.hideTooltip();
                        this.draw();
                    }
                }, 2000);
            }

            // NEW: Mobile-specific tooltip display
            showMobileTooltip(clientX, clientY) {
                const rect = this.canvas.getBoundingClientRect();
                const x = clientX - rect.left;
                
                const index = this.getIndexFromX(x);
                
                if (index >= 0 && index < this.data.length) {
                    const candle = this.data[index];
                    const tooltip = document.getElementById('chart-tooltip');
                    
                    if (tooltip) {
                        document.getElementById('tooltip-time').textContent = new Date(candle.time).toLocaleString();
                        document.getElementById('tooltip-open').textContent = '$' + candle.open.toFixed(3);
                        document.getElementById('tooltip-high').textContent = '$' + candle.high.toFixed(3);
                        document.getElementById('tooltip-low').textContent = '$' + candle.low.toFixed(3);
                        document.getElementById('tooltip-close').textContent = '$' + candle.close.toFixed(3);
                        document.getElementById('tooltip-volume').textContent = (candle.volume / 1000).toFixed(2) + 'K';
                        
                        // Position tooltip above finger for better visibility on mobile
                        tooltip.style.left = `${Math.min(Math.max(x - 75, 10), this.width - 160)}px`;
                        tooltip.style.top = `${Math.max(40, clientY - rect.top - 140)}px`;
                        tooltip.classList.remove('hidden');
                    }
                }
            }

            handleMouseMove(e) {
                const rect = this.canvas.getBoundingClientRect();
                this.crosshair.x = e.clientX - rect.left;
                this.crosshair.y = e.clientY - rect.top;
                this.draw();
                this.showTooltip(e.clientX, e.clientY);
                if (!this.isMobile) {
                    this.updateOHLCDisplay(e.clientX);
                }
            }

            handleMouseLeave() {
                this.crosshair.x = null;
                this.crosshair.y = null;
                this.hideTooltip();
                if (!this.isMobile) {
                    this.updateOHLCDisplay(null);
                }
                this.draw();
            }

            handleResize() {
                // CRITICAL: Recalculate canvas dimensions and regenerate data on resize
                this.setupCanvas();
                this.generateData();
                this.draw();
            }

            updateOHLCDisplay(x) {
                const ohlcOpen = document.getElementById('ohlc-open');
                const ohlcHigh = document.getElementById('ohlc-high');
                const ohlcLow = document.getElementById('ohlc-low');
                const ohlcClose = document.getElementById('ohlc-close');
                const currentVolume = document.getElementById('current-volume');
                
                if (!ohlcOpen || x === null) {
                    // Show latest candle data when not hovering
                    if (this.data.length > 0 && ohlcOpen) {
                        const latestCandle = this.data[this.data.length - 1];
                        ohlcOpen.textContent = latestCandle.open.toFixed(3);
                        ohlcHigh.textContent = latestCandle.high.toFixed(3);
                        ohlcLow.textContent = latestCandle.low.toFixed(3);
                        ohlcClose.textContent = latestCandle.close.toFixed(3);
                        if (currentVolume) currentVolume.textContent = (latestCandle.volume / 1000).toFixed(3) + 'K';
                    }
                    return;
                }
                
                const rect = this.canvas.getBoundingClientRect();
                const canvasX = x - rect.left;
                const index = this.getIndexFromX(canvasX);
                
                if (index >= 0 && index < this.data.length) {
                    const candle = this.data[index];
                    ohlcOpen.textContent = candle.open.toFixed(3);
                    ohlcHigh.textContent = candle.high.toFixed(3);
                    ohlcLow.textContent = candle.low.toFixed(3);
                    ohlcClose.textContent = candle.close.toFixed(3);
                    currentVolume.textContent = (candle.volume / 1000).toFixed(3) + 'K';
                }
            }

            showTooltip(x, y) {
                const tooltip = document.getElementById('chart-tooltip');
                if (!tooltip) return;
                
                const rect = this.canvas.getBoundingClientRect();
                const canvasX = x - rect.left;
                const index = this.getIndexFromX(canvasX);
                
                if (index >= 0 && index < this.data.length) {
                    const candle = this.data[index];
                    document.getElementById('tooltip-time').textContent = new Date(candle.time).toLocaleString();
                    document.getElementById('tooltip-open').textContent = '$' + candle.open.toFixed(3);
                    document.getElementById('tooltip-high').textContent = '$' + candle.high.toFixed(3);
                    document.getElementById('tooltip-low').textContent = '$' + candle.low.toFixed(3);
                    document.getElementById('tooltip-close').textContent = '$' + candle.close.toFixed(3);
                    document.getElementById('tooltip-volume').textContent = (candle.volume / 1000).toFixed(2) + 'K';
                    
                    tooltip.style.left = `${Math.min(x + 15, window.innerWidth - 200)}px`;
                    tooltip.style.top = `${Math.min(y + 15, window.innerHeight - 150)}px`;
                    tooltip.classList.remove('hidden');
                }
            }

            hideTooltip() {
                const tooltip = document.getElementById('chart-tooltip');
                if (tooltip) tooltip.classList.add('hidden');
            }

            getIndexFromX(x) {
                const padding = this.isMobile ? CONFIG.mobilePadding : CONFIG.chartPadding;
                const chartWidth = this.width - padding.left - padding.right;
                const candleFullWidth = CONFIG.candleWidth + CONFIG.candleGap;
                const maxVisible = Math.floor(chartWidth / candleFullWidth);
                const startIndex = Math.max(0, this.data.length - maxVisible);
                return Math.floor((x - padding.left) / candleFullWidth) + startIndex;
            }

            // CRITICAL FIX: Completely rewritten draw method with proper space allocation
            draw() {
                const padding = this.isMobile ? CONFIG.mobilePadding : CONFIG.chartPadding;
                
                // Clear entire canvas
                this.ctx.fillStyle = CONFIG.colors.bgPrimary;
                this.ctx.fillRect(0, 0, this.width, this.height);

                // CRITICAL: Calculate actual drawable area accounting for volume and padding
                const chartWidth = this.width - padding.left - padding.right;
                const totalChartArea = this.height - padding.top - padding.bottom;
                const chartHeight = totalChartArea - CONFIG.volumeHeight;
                
                // CRITICAL FIX: Calculate visible candles to fill entire width
                const candleFullWidth = CONFIG.candleWidth + CONFIG.candleGap;
                const maxVisible = Math.floor(chartWidth / candleFullWidth);
                
                // Always show most recent candles, filling entire width
                const startIndex = Math.max(0, this.data.length - maxVisible);
                const visibleData = this.data.slice(startIndex);
                
                console.log(`Drawing ${visibleData.length} candles (${startIndex} to ${this.data.length}) for width ${chartWidth}px`);

                // Price range and volume calculations
                const priceRange = { min: 23.0, max: 27.0 };
                const volumeMax = Math.max(...visibleData.map(d => d.volume));

                // FIXED RENDERING ORDER: Grid → Candles → Volume → Axes → Crosshair
                this.drawGrid(chartHeight, chartWidth, padding);
                this.drawCandlesticks(visibleData, priceRange, chartHeight, padding);
                this.drawVolume(visibleData, volumeMax, padding, chartHeight);
                this.drawPriceAxis(priceRange, chartHeight, padding);
                this.drawTimeAxis(visibleData, startIndex, padding, chartHeight);
                
                if (this.crosshair.x !== null && (this.isMobile ? this.touchActive : true)) {
                    this.drawCrosshair(chartHeight, padding);
                }
            }

            drawGrid(chartHeight, chartWidth, padding) {
                this.ctx.strokeStyle = CONFIG.colors.gridLineHorizontal;
                this.ctx.lineWidth = 1;
                this.ctx.setLineDash([4, 4]);

                for (let i = 0; i <= 8; i++) {
                    const y = padding.top + (chartHeight / 8) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(padding.left, y);
                    this.ctx.lineTo(this.width - padding.right, y);
                    this.ctx.stroke();
                }

                this.ctx.setLineDash([]);
                this.ctx.strokeStyle = CONFIG.colors.gridLineVertical;
                this.ctx.lineWidth = 1;

                const verticalGridCount = 10;
                for (let i = 0; i <= verticalGridCount; i++) {
                    const x = padding.left + (chartWidth / verticalGridCount) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, padding.top);
                    this.ctx.lineTo(x, padding.top + chartHeight);
                    this.ctx.stroke();
                }

                this.ctx.setLineDash([]);
            }

            // CRITICAL FIX: Candlesticks now render in correct space without cutoff
            drawCandlesticks(visibleData, priceRange, chartHeight, padding) {
                visibleData.forEach((candle, i) => {
                    const x = padding.left + i * (CONFIG.candleWidth + CONFIG.candleGap);
                    const isGreen = candle.close >= candle.open;
                    const color = isGreen ? CONFIG.colors.marketGreen : CONFIG.colors.marketRed;

                    // FIXED: Calculate Y positions within actual chart height
                    const openY = padding.top + (1 - (candle.open - priceRange.min) / (priceRange.max - priceRange.min)) * chartHeight;
                    const closeY = padding.top + (1 - (candle.close - priceRange.min) / (priceRange.max - priceRange.min)) * chartHeight;
                    const highY = padding.top + (1 - (candle.high - priceRange.min) / (priceRange.max - priceRange.min)) * chartHeight;
                    const lowY = padding.top + (1 - (candle.low - priceRange.min) / (priceRange.max - priceRange.min)) * chartHeight;

                    // Draw wick
                    this.ctx.strokeStyle = color;
                    this.ctx.lineWidth = 1;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x + CONFIG.candleWidth / 2, highY);
                    this.ctx.lineTo(x + CONFIG.candleWidth / 2, lowY);
                    this.ctx.stroke();

                    // Draw body
                    this.ctx.fillStyle = color;
                    const bodyHeight = Math.abs(closeY - openY);
                    const bodyY = Math.min(openY, closeY);
                    this.ctx.fillRect(x, bodyY, CONFIG.candleWidth, Math.max(1, bodyHeight));
                });
            }

            // CRITICAL FIX: Volume bars now render in designated space below chart
            drawVolume(visibleData, volumeMax, padding, chartHeight) {
                const volumeStartY = padding.top + chartHeight;
                
                visibleData.forEach((candle, i) => {
                    const x = padding.left + i * (CONFIG.candleWidth + CONFIG.candleGap);
                    const volumeRatio = candle.volume / volumeMax;
                    const barHeight = volumeRatio * CONFIG.volumeHeight;
                    const isGreen = candle.close >= candle.open;
                    
                    this.ctx.fillStyle = isGreen ? 'rgba(31, 211, 138, 0.9)' : 'rgba(224, 88, 88, 0.9)';
                    this.ctx.fillRect(x, volumeStartY + CONFIG.volumeHeight - barHeight, CONFIG.candleWidth, barHeight);
                });
            }

            drawPriceAxis(priceRange, chartHeight, padding) {
                this.ctx.fillStyle = CONFIG.colors.textMuted;
                this.ctx.font = this.isMobile ? '9px Inter' : '11px Inter';
                this.ctx.textAlign = 'left';

                for (let i = 0; i <= 8; i++) {
                    const price = priceRange.min + (priceRange.max - priceRange.min) * (i / 8);
                    const y = padding.top + chartHeight - (chartHeight / 8) * i;
                    this.ctx.fillText(price.toFixed(3), this.width - padding.right + 5, y + 4);
                }
            }

            drawTimeAxis(visibleData, startIndex, padding, chartHeight) {
                this.ctx.fillStyle = CONFIG.colors.textMuted;
                this.ctx.font = this.isMobile ? '9px Inter' : '11px Inter';
                this.ctx.textAlign = 'center';

                const step = Math.max(1, Math.floor(visibleData.length / 6));
                const timeAxisY = padding.top + chartHeight + CONFIG.volumeHeight + 15;
                
                for (let i = 0; i < visibleData.length; i += step) {
                    const candle = visibleData[i];
                    const x = padding.left + i * (CONFIG.candleWidth + CONFIG.candleGap) + CONFIG.candleWidth / 2;
                    const date = new Date(candle.time);
                    const timeStr = `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                    this.ctx.fillText(timeStr, x, timeAxisY);
                }
            }

            drawCrosshair(chartHeight, padding) {
                this.ctx.strokeStyle = CONFIG.colors.borderSubtle;
                this.ctx.lineWidth = 1;
                this.ctx.setLineDash([4, 4]);

                this.ctx.beginPath();
                this.ctx.moveTo(this.crosshair.x, padding.top);
                this.ctx.lineTo(this.crosshair.x, padding.top + chartHeight);
                this.ctx.stroke();

                this.ctx.beginPath();
                this.ctx.moveTo(padding.left, this.crosshair.y);
                this.ctx.lineTo(this.width - padding.right, this.crosshair.y);
                this.ctx.stroke();

                this.ctx.setLineDash([]);
            }
        }

        // CRITICAL FIX: Enhanced Order Book Manager with Mobile Support
        class OrderBookManager {
            constructor() {
                this.init();
            }

            init() {
                this.renderOrderBook();
                this.renderMobileOrderBook(); // NEW: Render mobile order book on initialization
                this.startUpdates();
                this.setupTabSwitching();
            }

            setupTabSwitching() {
                document.querySelectorAll('.orderbook-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.orderbook-tab').forEach(t => {
                            t.classList.remove('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                            t.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                    });
                });

                // NEW: Setup mobile order book tab switching
                document.querySelectorAll('.mobile-orderbook-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.mobile-orderbook-tab').forEach(t => {
                            t.classList.remove('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                            t.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                    });
                });
            }

            renderOrderBook() {
                const sellContainer = document.getElementById('sell-orders');
                const buyContainer = document.getElementById('buy-orders');

                if (sellContainer) {
                    sellContainer.innerHTML = orderBookData.sellOrders.map(order => `
                        <div class="grid grid-cols-3 gap-1 text-[9px] text-[#6B7C8B] relative overflow-hidden py-0.5">
                            <div class="absolute inset-0 bg-[rgba(224,88,88,0.08)] origin-right" style="width: ${(order.size / 4) * 100}%"></div>
                            <span class="relative z-10 text-left">${order.price.toFixed(3)}</span>
                            <span class="relative z-10 text-right">${order.size.toFixed(3)}</span>
                            <span class="relative z-10 text-right">${order.total.toFixed(3)}</span>
                        </div>
                    `).join('');
                }

                if (buyContainer) {
                    buyContainer.innerHTML = orderBookData.buyOrders.map(order => `
                        <div class="grid grid-cols-3 gap-1 text-[9px] text-[#6B7C8B] relative overflow-hidden py-0.5">
                            <div class="absolute inset-0 bg-[rgba(31,211,138,0.08)] origin-right" style="width: ${(order.size / 4) * 100}%"></div>
                            <span class="relative z-10 text-left">${order.price.toFixed(3)}</span>
                            <span class="relative z-10 text-right">${order.size.toFixed(3)}</span>
                            <span class="relative z-10 text-right">${order.total.toFixed(3)}</span>
                        </div>
                    `).join('');
                }
            }

            // NEW: Mobile-specific order book rendering
            renderMobileOrderBook() {
                const mobileSellContainer = document.getElementById('mobile-sell-orders');
                const mobileBuyContainer = document.getElementById('mobile-buy-orders');

                if (mobileSellContainer) {
                    mobileSellContainer.innerHTML = orderBookData.sellOrders.map(order => `
                        <div class="grid grid-cols-3 gap-2 text-[11px] text-[#E05858] relative overflow-hidden py-1.5">
                            <div class="absolute inset-0 bg-[rgba(224,88,88,0.08)] origin-right" style="width: ${(order.size / 4) * 100}%"></div>
                            <span class="relative z-10 text-left font-mono font-medium">${order.price.toFixed(3)}</span>
                            <span class="relative z-10 text-right font-mono">${order.size.toFixed(3)}</span>
                            <span class="relative z-10 text-right font-mono">${order.total.toFixed(3)}</span>
                        </div>
                    `).join('');
                }

                if (mobileBuyContainer) {
                    mobileBuyContainer.innerHTML = orderBookData.buyOrders.map(order => `
                        <div class="grid grid-cols-3 gap-2 text-[11px] text-[#1FD38A] relative overflow-hidden py-1.5">
                            <div class="absolute inset-0 bg-[rgba(31,211,138,0.08)] origin-right" style="width: ${(order.size / 4) * 100}%"></div>
                            <span class="relative z-10 text-left font-mono font-medium">${order.price.toFixed(3)}</span>
                            <span class="relative z-10 text-right font-mono">${order.size.toFixed(3)}</span>
                            <span class="relative z-10 text-right font-mono">${order.total.toFixed(3)}</span>
                        </div>
                    `).join('');
                }
            }

            startUpdates() {
                setInterval(() => {
                    orderBookData.sellOrders.forEach(order => {
                        order.size += (Math.random() - 0.5) * 0.2;
                        order.size = Math.max(0.1, Math.min(5.0, order.size));
                        order.total = order.price * order.size;
                    });
                    orderBookData.buyOrders.forEach(order => {
                        order.size += (Math.random() - 0.5) * 0.2;
                        order.size = Math.max(0.1, Math.min(5.0, order.size));
                        order.total = order.price * order.size;
                    });
                    this.renderOrderBook();
                    this.renderMobileOrderBook(); // NEW: Also update mobile order book
                }, 1500);

                setInterval(() => {
                    if (Math.random() > 0.5) {
                        const idx1 = Math.floor(Math.random() * orderBookData.sellOrders.length);
                        const idx2 = Math.floor(Math.random() * orderBookData.sellOrders.length);
                        [orderBookData.sellOrders[idx1], orderBookData.sellOrders[idx2]] = 
                        [orderBookData.sellOrders[idx2], orderBookData.sellOrders[idx1]];
                    }

                    if (Math.random() > 0.5) {
                        const idx1 = Math.floor(Math.random() * orderBookData.buyOrders.length);
                        const idx2 = Math.floor(Math.random() * orderBookData.buyOrders.length);
                        [orderBookData.buyOrders[idx1], orderBookData.buyOrders[idx2]] = 
                        [orderBookData.buyOrders[idx2], orderBookData.buyOrders[idx1]];
                    }

                    if (Math.random() > 0.7) {
                        const priceShift = (Math.random() - 0.5) * 0.05;
                        orderBookData.sellOrders.forEach(order => {
                            order.price += priceShift;
                            order.price = Math.max(25.0, Math.min(28.0, order.price));
                            order.total = order.price * order.size;
                        });
                        orderBookData.buyOrders.forEach(order => {
                            order.price += priceShift;
                            order.price = Math.max(23.0, Math.min(26.0, order.price));
                            order.total = order.price * order.size;
                        });
                    }

                    this.renderOrderBook();
                    this.renderMobileOrderBook(); // NEW: Also update mobile order book
                }, 3000);
            }
        }

        // Trading Panel Manager - NEW CLASS for Buy/Sell toggle functionality
        class TradingPanelManager {
            constructor() {
                this.currentMode = 'buy'; // Track current trading mode
                this.init();
            }

            init() {
                this.setupToggleButtons();
                this.updatePrimaryCTA();
            }

            setupToggleButtons() {
                // Get all Buy/Sell toggle button containers
                const toggleContainers = document.querySelectorAll('.flex.gap-1');
                
                toggleContainers.forEach(container => {
                    const buyBtn = container.querySelector('button:first-child');
                    const sellBtn = container.querySelector('button:last-child');
                    
                    if (buyBtn && sellBtn && buyBtn.textContent.trim() === 'Buy' && sellBtn.textContent.trim() === 'Sell') {
                        // Buy button click handler
                        buyBtn.addEventListener('click', () => {
                            this.currentMode = 'buy';
                            this.updateToggleState(buyBtn, sellBtn);
                            this.updatePrimaryCTA();
                        });
                        
                        // Sell button click handler - NOW FULLY FUNCTIONAL
                        sellBtn.addEventListener('click', () => {
                            this.currentMode = 'sell';
                            this.updateToggleState(sellBtn, buyBtn);
                            this.updatePrimaryCTA();
                        });
                    }
                });
            }

            updateToggleState(activeBtn, inactiveBtn) {
                // Update active button
                activeBtn.classList.remove('bg-transparent', 'text-[#6B7C8B]', 'border', 'border-[#1F2A33]');
                activeBtn.classList.add(
                    this.currentMode === 'buy' ? 'bg-[rgba(31,211,138,0.15)]' : 'bg-[rgba(224,88,88,0.15)]',
                    this.currentMode === 'buy' ? 'text-[#1FD38A]' : 'text-[#E05858]'
                );
                
                // Update inactive button
                inactiveBtn.classList.remove('bg-[rgba(31,211,138,0.15)]', 'bg-[rgba(224,88,88,0.15)]', 'text-[#1FD38A]', 'text-[#E05858]');
                inactiveBtn.classList.add('bg-transparent', 'text-[#6B7C8B]', 'border', 'border-[#1F2A33]');
            }

            updatePrimaryCTA() {
                // Update the primary CTA button
                const ctaButtons = document.querySelectorAll('button.w-full.h-8');
                
                ctaButtons.forEach(btn => {
                    if (btn.textContent.includes('Buy HYPE') || btn.textContent.includes('Sell HYPE')) {
                        if (this.currentMode === 'buy') {
                            btn.textContent = 'Buy HYPE';
                            btn.classList.remove('bg-[#E05858]', 'hover:bg-[#D04848]');
                            btn.classList.add('bg-[#2DD4BF]', 'hover:bg-[#22D3EE]');
                        } else {
                            btn.textContent = 'Sell HYPE';
                            btn.classList.remove('bg-[#2DD4BF]', 'hover:bg-[#22D3EE]');
                            btn.classList.add('bg-[#E05858]', 'hover:bg-[#D04848]');
                        }
                    }
                });
            }
        }

        // Timestamp Manager
        class TimestampManager {
            constructor() {
                this.timestampElement = document.getElementById('chart-timestamp');
                if (this.timestampElement) {
                    this.updateTimestamp();
                    setInterval(() => this.updateTimestamp(), 1000);
                }
            }

            updateTimestamp() {
                const now = new Date();
                const hours = String(now.getUTCHours()).padStart(2, '0');
                const minutes = String(now.getUTCMinutes()).padStart(2, '0');
                const seconds = String(now.getUTCSeconds()).padStart(2, '0');
                this.timestampElement.textContent = `${hours}:${minutes}:${seconds} UTC`;
            }
        }

        // Market Pair Dropdown Manager
        class MarketPairDropdownManager {
            constructor() {
                this.currentCategory = 'All';
                this.currentMode = 'all';
                this.searchQuery = '';
                this.init();
            }

            init() {
                this.renderDropdown();
                this.setupEventListeners();
            }

            setupEventListeners() {
                const searchInput = document.getElementById('market-search-input');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchQuery = e.target.value.toLowerCase();
                        this.renderPairsList();
                    });
                }

                document.querySelectorAll('.mode-toggle-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.currentMode = e.target.dataset.mode;
                        document.querySelectorAll('.mode-toggle-btn').forEach(b => {
                            b.classList.remove('bg-[#2DD4BF]', 'text-[#0B131A]');
                            b.classList.add('text-[#9FB0BF]');
                        });
                        e.target.classList.remove('text-[#9FB0BF]');
                        e.target.classList.add('bg-[#2DD4BF]', 'text-[#0B131A]');
                        this.renderPairsList();
                    });
                });

                document.querySelectorAll('.category-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.currentCategory = e.target.dataset.category;
                        document.querySelectorAll('.category-tab').forEach(t => {
                            t.classList.remove('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                            t.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                        this.renderPairsList();
                    });
                });

                document.addEventListener('click', (e) => {
                    const pairRow = e.target.closest('.market-pair-row');
                    if (pairRow) {
                        const symbol = pairRow.dataset.symbol;
                        this.selectPair(symbol);
                    }

                    const favoriteBtn = e.target.closest('.favorite-star');
                    if (favoriteBtn) {
                        e.stopPropagation();
                        const symbol = favoriteBtn.dataset.symbol;
                        this.toggleFavorite(symbol);
                    }
                });
            }

            toggleFavorite(symbol) {
                const pair = marketPairsData.find(p => p.symbol === symbol);
                if (pair) {
                    pair.favorite = !pair.favorite;
                    this.renderPairsList();
                }
            }

            selectPair(symbol) {
                const pair = marketPairsData.find(p => p.symbol === symbol);
                if (pair) {
                    const marketPairBtn = document.getElementById('market-pair-btn');
                    if (marketPairBtn) {
                        marketPairBtn.querySelector('h1').textContent = symbol;
                    }
                    
                    const dropdown = document.getElementById('market-pair-dropdown');
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                    }
                }
            }

            getFilteredPairs() {
                let filtered = marketPairsData;

                if (this.searchQuery) {
                    filtered = filtered.filter(pair => 
                        pair.symbol.toLowerCase().includes(this.searchQuery)
                    );
                }

                if (this.currentCategory !== 'All') {
                    filtered = filtered.filter(pair => 
                        pair.category.includes(this.currentCategory)
                    );
                }

                if (this.currentMode === 'strict') {
                    filtered = filtered.filter(pair => pair.favorite);
                }

                return filtered;
            }

            formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(2) + 'K';
                return num.toFixed(2);
            }

            renderPairsList() {
                const container = document.getElementById('pairs-list-container');
                const pairsCount = document.getElementById('pairs-count');
                if (!container) return;

                const filteredPairs = this.getFilteredPairs();
                
                if (pairsCount) {
                    pairsCount.textContent = filteredPairs.length;
                }

                if (filteredPairs.length === 0) {
                    container.innerHTML = `
                        <div class="py-12 text-center text-[#6B7C8B] text-[13px]">
                            No pairs found matching your criteria
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredPairs.map(pair => {
                    const changeColor = pair.change24h >= 0 ? 'text-[#1FD38A]' : 'text-[#E05858]';
                    const changeSign = pair.change24h >= 0 ? '+' : '';
                    
                    return `
                        <div class="market-pair-row px-4 py-3 hover:bg-[#121F29] cursor-pointer transition-colors border-b border-[#1F2A33] last:border-b-0" data-symbol="${pair.symbol}">
                            <div class="grid grid-cols-[24px_1fr_100px_90px_85px_90px_110px] gap-4 items-center text-[11px]">
                                <button class="favorite-star w-4 h-4 flex items-center justify-center text-[#6B7C8B] hover:text-[#FCD34D] transition-colors" data-symbol="${pair.symbol}">
                                    ${pair.favorite ? 
                                        '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#FCD34D" stroke="#FCD34D" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>' :
                                        '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>'
                                    }
                                </button>
                                <div class="text-left min-w-0">
                                    <div class="font-semibold text-[#E6EEF5] truncate">${pair.symbol}</div>
                                    <div class="text-[9px] text-[#6B7C8B] uppercase">${pair.type}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-mono font-medium text-[#E6EEF5]">$${pair.lastPrice.toLocaleString()}</div>
                                </div>
                                <div class="text-right">
                                    <div class="${changeColor} font-semibold">${changeSign}${pair.change24h.toFixed(2)}%</div>
                                </div>
                                <div class="text-right text-[#9FB0BF] font-mono text-[10px]">
                                    ${pair.funding8h !== null ? pair.funding8h.toFixed(4) + '%' : '-'}
                                </div>
                                <div class="text-right text-[#9FB0BF] font-mono text-[10px]">
                                    ${this.formatNumber(pair.volume)}
                                </div>
                                <div class="text-right text-[#9FB0BF] font-mono text-[10px]">
                                    ${pair.openInterest !== null ? this.formatNumber(pair.openInterest) : '-'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderDropdown() {
                this.renderPairsList();
            }
        }

        // Mobile Pairs Dropdown Manager
        class MobilePairsDropdownManager {
            constructor() {
                this.currentCategory = 'All';
                this.searchQuery = '';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.renderMobilePairsList();
            }

            setupEventListeners() {
                const mobileMarketPairBtn = document.getElementById('mobile-market-pair-btn');
                const mobileDropdown = document.getElementById('mobile-market-pair-dropdown');

                if (mobileMarketPairBtn && mobileDropdown) {
                    mobileMarketPairBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        mobileDropdown.classList.toggle('hidden');
                    });

                    document.addEventListener('click', (e) => {
                        if (!mobileDropdown.contains(e.target) && !mobileMarketPairBtn.contains(e.target)) {
                            mobileDropdown.classList.add('hidden');
                        }
                    });
                }

                const mobileSearchInput = document.getElementById('mobile-market-search-input');
                if (mobileSearchInput) {
                    mobileSearchInput.addEventListener('input', (e) => {
                        this.searchQuery = e.target.value.toLowerCase();
                        this.renderMobilePairsList();
                    });
                }

                document.querySelectorAll('.mobile-category-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.currentCategory = e.target.dataset.category;
                        document.querySelectorAll('.mobile-category-tab').forEach(t => {
                            t.classList.remove('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                            t.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                        this.renderMobilePairsList();
                    });
                });

                document.addEventListener('click', (e) => {
                    const mobilePairRow = e.target.closest('.mobile-market-pair-row');
                    if (mobilePairRow) {
                        const symbol = mobilePairRow.dataset.symbol;
                        this.selectMobilePair(symbol);
                    }
                });
            }

            selectMobilePair(symbol) {
                const pair = marketPairsData.find(p => p.symbol === symbol);
                if (pair) {
                    const mobileMarketPairBtn = document.getElementById('mobile-market-pair-btn');
                    if (mobileMarketPairBtn) {
                        mobileMarketPairBtn.querySelector('span').textContent = symbol;
                    }
                    
                    const mobileDropdown = document.getElementById('mobile-market-pair-dropdown');
                    if (mobileDropdown) {
                        mobileDropdown.classList.add('hidden');
                    }
                }
            }

            getFilteredPairs() {
                let filtered = marketPairsData;

                if (this.searchQuery) {
                    filtered = filtered.filter(pair => 
                        pair.symbol.toLowerCase().includes(this.searchQuery)
                    );
                }

                if (this.currentCategory !== 'All') {
                    filtered = filtered.filter(pair => 
                        pair.category.includes(this.currentCategory)
                    );
                }

                return filtered;
            }

            renderMobilePairsList() {
                const container = document.getElementById('mobile-pairs-list-container');
                if (!container) return;

                const filteredPairs = this.getFilteredPairs();

                if (filteredPairs.length === 0) {
                    container.innerHTML = `
                        <div class="py-12 text-center text-[#6B7C8B] text-sm">
                            No pairs found
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredPairs.map(pair => {
                    const changeColor = pair.change24h >= 0 ? 'text-[#1FD38A]' : 'text-[#E05858]';
                    const changeSign = pair.change24h >= 0 ? '+' : '';
                    
                    return `
                        <div class="mobile-market-pair-row px-4 py-3 hover:bg-[#121F29] cursor-pointer transition-colors border-b border-[#1F2A33] last:border-b-0" data-symbol="${pair.symbol}">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="text-sm font-semibold text-[#E6EEF5]">${pair.symbol}</div>
                                    <div class="text-[10px] text-[#6B7C8B] uppercase mt-0.5">${pair.type}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-mono font-medium text-[#E6EEF5]">$${pair.lastPrice.toLocaleString()}</div>
                                    <div class="text-xs ${changeColor} font-semibold mt-0.5">${changeSign}${pair.change24h.toFixed(2)}%</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Mobile UI Manager
        class MobileUIManager {
            constructor() {
                this.init();
            }

            init() {
                // Mobile content tabs
                document.querySelectorAll('.mobile-content-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const content = e.target.dataset.content;
                        
                        document.querySelectorAll('.mobile-content-tab').forEach(t => {
                            t.classList.remove('text-[#2DD4BF]', 'border-b-2', 'border-[#2DD4BF]');
                            t.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('text-[#2DD4BF]', 'border-b-2', 'border-[#2DD4BF]');
                        
                        document.querySelectorAll('[id^="mobile-"][id$="-content"]').forEach(c => c.classList.add('hidden'));
                        document.getElementById(`mobile-${content}-content`)?.classList.remove('hidden');
                    });
                });

                // Mobile timeframe buttons
                document.querySelectorAll('.mobile-timeframe-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.mobile-timeframe-btn').forEach(b => {
                            b.classList.remove('active', 'text-[#E6EEF5]', 'bg-[#121F29]');
                            b.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('active', 'text-[#E6EEF5]', 'bg-[#121F29]');
                    });
                });

                // Mobile position tabs
                document.querySelectorAll('.mobile-position-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.mobile-position-tab').forEach(t => {
                            t.classList.remove('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                            t.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('text-[#E6EEF5]', 'border-b-2', 'border-[#2DD4BF]');
                    });
                });

                // Mobile bottom navigation
                document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.mobile-nav-btn').forEach(b => {
                            b.classList.remove('text-[#2DD4BF]', 'bg-[rgba(45,212,191,0.05)]');
                            b.classList.add('text-[#6B7C8B]');
                        });
                        e.currentTarget.classList.remove('text-[#6B7C8B]');
                        e.currentTarget.classList.add('text-[#2DD4BF]', 'bg-[rgba(45,212,191,0.05)]');
                    });
                });
            }
        }

        // Desktop UI Interactions
        class UIManager {
            constructor() {
                this.init();
            }

            init() {
                const mobileMenuBtn = document.getElementById('mobile-menu-btn');
                const mobileMenu = document.getElementById('mobile-menu');

                if (mobileMenuBtn && mobileMenu) {
                    mobileMenuBtn.addEventListener('click', () => {
                        mobileMenu.classList.toggle('hidden');
                    });
                }

                const marketPairBtn = document.getElementById('market-pair-btn');
                const marketPairDropdown = document.getElementById('market-pair-dropdown');

                if (marketPairBtn && marketPairDropdown) {
                    marketPairBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        marketPairDropdown.classList.toggle('hidden');
                    });

                    document.addEventListener('click', (e) => {
                        if (!marketPairDropdown.contains(e.target) && !marketPairBtn.contains(e.target)) {
                            marketPairDropdown.classList.add('hidden');
                        }
                    });
                }

                const moreBtn = document.getElementById('more-btn');
                const moreDropdown = document.getElementById('more-dropdown');

                if (moreBtn && moreDropdown) {
                    moreBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        moreDropdown.classList.toggle('hidden');
                    });

                    document.addEventListener('click', (e) => {
                        if (!moreDropdown.contains(e.target) && !moreBtn.contains(e.target)) {
                            moreDropdown.classList.add('hidden');
                        }
                    });
                }

                document.querySelectorAll('.timeframe-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                    });
                });

                document.querySelectorAll('.long-timeframe-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.long-timeframe-btn').forEach(b => {
                            b.classList.remove('active', 'text-[#E6EEF5]', 'bg-[#121F29]');
                            b.classList.add('text-[#6B7C8B]');
                        });
                        e.target.classList.remove('text-[#6B7C8B]');
                        e.target.classList.add('active', 'text-[#E6EEF5]', 'bg-[#121F29]');
                    });
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // NEW: Initialize market data manager first
            const marketDataManager = new MarketDataManager();
            
            // Desktop chart
            const chart = new TradingChart('trading-chart', false);
            chart.marketDataManager = marketDataManager; // Connect chart to live market data
            
            // Mobile chart with touch support
            const mobileChart = new TradingChart('mobile-trading-chart', true);
            mobileChart.marketDataManager = marketDataManager; // Connect mobile chart to live market data
            
            // Shared components
            const orderBook = new OrderBookManager();
            const timestampManager = new TimestampManager();
            const marketPairDropdown = new MarketPairDropdownManager();
            
            // Mobile-specific components
            const mobilePairsDropdown = new MobilePairsDropdownManager();
            
            // UI managers
            const ui = new UIManager();
            const mobileUI = new MobileUIManager();
            
            // NEW: Trading Panel Manager - Makes Sell button functional
            const tradingPanel = new TradingPanelManager();
        });
    </script>
<script id="dhws-data-injector" src="/public/dhws-data-injector.js"></script>
</body>
</html>